{% load widget_tweaks %}


{% if more_back %}
    <a href="{{ request.path }}?interval={{ interval }}&from={{ back_from }}">Earlier Messages</a>
{% endif %}
<div class="bg-gray-light -mx-4.5 px-4.5 py-4">
    {% for message in messages %}
        {% if message.sender == system_user %}
            {% include 'messaging/system_message_snippet.html' %}
        {% else %}
            {% include 'messaging/user_message_snippet.html' %}
            {% include "partials/vertical-spacer.html" with space="6" %}
        {% endif %}

    {% endfor %}
</div>
{% if from != 0 %}
    <a href="{{ request.path }}?interval={{ interval }}&from={{ forward_from }}">Later Messages</a>
{% endif %}
{% if request.user.is_anonymous %}
    {{ user_anonymous_message }}
{% elif request.user not in members %}
    {{ not_member_message }}
{% else %}
    {% if direct %}
        <form method="post" enctype="multipart/form-data" class="relative -m-4.5 p-4.5">
            {% csrf_token %}

            <div class="text-meta invisible max-w-full">
                {% render_field form.image %}
            </div>

            <div class="flex w-full max-w-full items-center">
                <div class="">
                    {% comment %}
                        Note that this only provides a hint to the browser as to what file-types to display to the user,
                        but this can be easily circumvented, so you should always validate the uploaded file on the server also.
                    {% endcomment %}
                    <label class="cursor-pointer" for="id_image">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 2V16H2V2H16ZM16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0ZM11.14 8.86L8.14 12.73L6 10.14L3 14H15L11.14 8.86Z"
                                  fill="#9759FF"/>
                        </svg>
                    </label>
                </div>

                {% include "partials/horizontal-spacer.html" with space="1.5" %}

                <div class="w-full">
                    <textarea data-expandable
                            class="input-text input-text-messages bg-yellow rounded-xl w-full max-w-full"
                            name=text></textarea>

                    {% comment %}            <textarea name=message></textarea>
                                <input type="file" id="image" name="image">{% endcomment %}

                    <button type="submit" class="absolute bottom-[34px] right-8">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0 8L1.41 9.41L7 3.83V16H9V3.83L14.58 9.42L16 8L8 0L0 8Z" fill="#9759FF"/>
                        </svg>
                    </button>
                </div>
            </div>

        </form>
    {% else %}
        <form method=POST>
            {% csrf_token %}
            <textarea name=text></textarea>
            <input type="file" id="image" name="image">

            <button type="submit">Send</button>

        </form>
    {% endif %}
{% endif %}

{# bg-blue-blur fixed bottom-4.5 resize-none #}

{% block scripts %}
    <script>
        $('body').on('keydown input', 'textarea[data-expandable]', function () {
            console.log('why not tho');
            // Auto-expanding textarea
            this.style.removeProperty('height');
            this.style.height = (this.scrollHeight + 2) + 'px';
        }).on('mousedown focus', 'textarea[data-expandable]', function () {
            // Do this on focus, to allow textarea to animate to height...
            this.style.removeProperty('height');
            this.style.height = (this.scrollHeight + 2) + 'px';
        });
    </script>
{% endblock %}