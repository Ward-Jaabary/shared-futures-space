{% extends "account/base.html" %}
{% comment %} Page: reset password via clicked email link - /account/password/reset/key/{{dynamically-generated-token}}/
{% endcomment %}

{% load account %}

{% load static %}
{% load widget_tweaks %}

{% block content %}

    <div class="flex flex-col h-screen">

        {% block title %}{% include "partials/title.html" with title="Set a new password" %}{% endblock %}

        <div class="h-3"></div>

        {% if token_fail %}

            {% url 'account_reset_password' as passwd_reset_url %}
            <p class="font-garamond-500 text-black-large text-xl text-22 px-4 pb-9">
                The password reset link was invalid, possibly because it has already been used. Please request a new
                password reset.
            </p>

            <a href="{% url 'account_reset_password' %}"
               class="button button-on-white">
                Request password reset
            </a>

        {% else %}

            {% if form %}
                <form class="px-4 m-0" method="POST" action="{{ action_url }}"
                      x-init="setupObserversPsChange(); console.log('here');" onsubmit="return validateResetKey()"  class="password_change px-4">
                    {% csrf_token %}

                    <div class="px-4 pb-9">
                        {% include "partials/input-label.html" with for="password-input1" label="New Password" %}
                        {% include "partials/input-text.html" with field=form.password1 id="password-input1" name="password-input1" type="password" %}

                        <span id="password-feedback1"
                              class="hidden block text-red-important font-kanit-400 text-xxs pt-2">Feedback 1</span>

                    </div>

                    <div class="px-4 pb-9">
                        {% include "partials/input-label.html" with for="password-input2" label="Repeat password" %}
                        {% include "partials/input-text.html" with field=form.password2 id="password-input2" name="password-input2" type="password" %}


                        <span id="password-feedback2"
                              class="hidden block text-red-important font-kanit-400 text-xxs pt-2">Feedback 2</span>

                    </div>


                    <button id="submit-button"
                            type="submit"
                            class="button button-on-white"
                            name="action">
                        Set password
                    </button>
                </form>
                <div class="h-9"></div>
            {% else %}
                <p class="font-garamond-500 text-black-large text-xl text-22 px-4">
                    Your password is now changed.
                </p>
                <div class="h-9"></div>
            {% endif %}

        {% endif %}

        {% include "partials/footer-gradient.html" %}
    </div>

    {% block scripts %}
        <script src="{% static 'js/auth_helper.js' %}"></script>

        <script src="{% static 'js/password_change.js' %}"></script>
        <script>
            function validateResetKey() {

                if (passwordFeedbackOne === null) return
                let errorCount = 0
                errorCount += validateInputFeedback(passwordInputOne, passwordFeedbackOne)
                return errorCount == 0

            }

        </script>

    {% endblock %}

{% endblock %}